<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="style/style.css">

  <title>Train Schedule</title>
</head>

<body>
  <div class="container bg-transparent">

    <div class="jumbotron bg-transparent text-white">
      <h1 class="display-4 text-center">Welcome to the Crazy Train Scheduler!</h1><br>
      <p class="lead text-center">Join me as I go off the rails on a crazy train!</p>
      <p class="lead text-center" id="current-time"></p>
    </div>

    <div class="card border border-dark">
      <div class="card-header bg-dark text-white font-weight-bold">
        Crazy Train Schedule
      </div>
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Train Name</th>
            <th scope="col">Destination</th>
            <th scope="col">Frequency (min)</th>
            <th scope="col">Next Arrival</th>
            <th scope="col">Mins Away</th>
          </tr>
        </thead>
        <tbody id="details">
        </tbody>
      </table>
    </div>

    <div class="card mt-4 mb-4 border border-dark">
      <div class="card-header bg-dark text-white font-weight-bold">
        Add a Crazy Train
      </div>
      <form>
        <div class="form-group font-weight-bold pl-3 pr-3 pt-3">
          <label for="formGroupExampleInput">Train Name</label>
          <input type="text" class="form-control" id="train-name" placeholder="Text Here">
        </div>
        <div class="form-group font-weight-bold pl-3 pr-3 pt-1">
          <label for="formGroupExampleInput2">Destination</label>
          <input type="text" class="form-control" id="destination" placeholder="Text Here">
        </div>
        <div class="form-group font-weight-bold pl-3 pr-3 pt-1">
          <label for="formGroupExampleInput2">First Train Time (24 hr format)</label>
          <input type="text" class="form-control" id="first-train-time" placeholder="Ex: 12:34">
        </div>
        <div class="form-group font-weight-bold pl-3 pr-3 pt-1">
          <label for="formGroupExampleInput2">Frequency (min)</label>
          <input type="text" class="form-control" id="frequency" placeholder="Text Here">
        </div>
        <button class="btn btn-secondary ml-3 mb-3" id="submit" type="submit">&#9760;Submit &#9760;</button>
      </form>
    </div>

  </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/6.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.6.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
    <script>

      var firebaseConfig = {
        apiKey: "AIzaSyB6h45dkNSs8PAiSdrdGku0lEK_JL_nCwo",
        authDomain: "ap-cbc-activities.firebaseapp.com",
        databaseURL: "https://ap-cbc-activities.firebaseio.com",
        projectId: "ap-cbc-activities",
        storageBucket: "",
        messagingSenderId: "702662169387",
        appId: "1:702662169387:web:7bd3a4d534c9eee66dab6e"
      };

      console.log(firebaseConfig);
      firebase.initializeApp(firebaseConfig);

      var database = firebase.database();

      $("#submit").on("click", function (event) {
        event.preventDefault();

        var trainName = $("#train-name").val();
        var destination = $("#destination").val();
        var firstTrainTime = moment($("#first-train-time").val().trim(),"HH:mm").subtract(10,"years").format("X");
        var frequency = $("#frequency").val();

        database.ref().push({
          trainName: trainName,
          destination: destination,
          firstTrainTime: firstTrainTime,
          frequency: frequency,
        });
      });

      database.ref().on(
        "child_added",
        function (childSnapshot) {


          var newRow = $("<tr>");

          newRow.append("<td>" + childSnapshot.val().trainName + "</td>");
          newRow.append("<td>" + childSnapshot.val().destination + "</td>");
          newRow.append("<td>" + "Every " + childSnapshot.val().frequency + " mins" + "</td>");
          $("#details").append(newRow);
        })

        // var currentTime = moment().format("H:mm:ss");
        // $("#current-time").append(currentTime);


        // var myVar = setInterval(myTimer, 1000);

        //     function myTimer() {
        //       var d = new Date();
        //       var t = d.toLocaleTimeString();
        //       $("#current-time").append(t)
        //     }

        var currentTime = setInterval(myTimer, 1000);

            function myTimer() {
              var d = new Date();
              var t = d.toLocaleTimeString('en-GB');
              document.getElementById("current-time").innerHTML = "Current Time: " + t;
            }

    </script>

</body>

</html>